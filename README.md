# Minesweeper

Проект сделан в качестве тестового задания.

Деплой: https://rioskill.github.io/minesweeper/

! Проект тестировался в Chromium 126.0.6478.182 и Firefox 128.0

## Сборка

Для сборки и прогонки тестов используется bun (https://bun.sh/).

Запуск live server'а:

```
npm run start
```

Прогон тестов:
```
npm run test
```

## Игровой процесс

ЛКМ - открытие клетки

*Первый клик не может привести к проигрышу*

ПКМ - обозначение клетки флажком

*При нажатии на клетку с флажком ничего не происходит*

---

Для передвижения по большим полям, не помещающихся в экране можно использовать:
- Колёсико мыши
- Scroll тачпада
- Клавиши стрелок
- Скроллбары

*При использовании мыши вертикальный скролл достигается кручением колёсика, горизонтальный - кручением колёсика с зашатой клавишей Shift*

## Немножко про реализацию

### Настройки

В игре есть 2 вида рендера с возможностью их переключения во время игры:
- webGL
- HTML5 Canvas

---

Также присутствует 2 темы:
- стандартная
- тёмная

Для переключения видов рендера и тем справа от игрового поля присутсвуют соответствующие меню.

*Все выбранные настройки сохраняются в IndexedDB.*

### Сохранения

Также существует возможность сохранить текущее состояние игры, нажав на кнопку Save. При закрытии вкладки и последующем её открытии будет сохранённое состояние игры будет восстановлено.

---

### Отрисовка больших полей

Для отрисовки больших полей было решено разделить игровое поле на чанки. В один момент времени в видеопамяти загружено только 4 чанка: опорный и 3 его смежных.

*Под опорным чанком понимается чанк, координаты которого соответствуют текущему смещению "камеры"*

Обновление данных в видеопамяти происходит при
- изменении опорного чанка
- обновлении игрового поля

*в коде функция называется updateOffset, но при обновлении игрового поля она тоже вызывается*

---

### Обработка больших разреженных полей

Обновление игрового поля происходит не моментально. Если игрок открыл пустую ячейку, все смежные с ней пустые ячейки или ячейки с цифрами также откроются. Чтобы игра не зависала при большом количестве смежных пустых ячеек, решено было ограничить количество открывающихся в один "такт" ячеек до 1000. (число выбрано случайно). После чего управление возвращается браузеру. Остальные пустые ячейки при этом также откроются, но позже.

## Возможные улучшения

1. Индикаторы количества оставшихся мин и таймера имеют фиксированный размер (3 цифры) и не сохраняются при нажатии кнопки Save.
2. Таймер показывает неточное время.
3. Границы "ячеек" стоило бы вшить в спрайты, а не рисовать их в рантайме.
