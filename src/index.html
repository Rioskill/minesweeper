<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MineSweeper</title>

    <link rel="stylesheet" href="src/index.css"/>

    <script src="build/index.js" defer></script>
</head>
<body>
    <div class="main">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </div>
    
    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 100

        attribute vec2 aPosition;
        attribute vec2 aTextureCoord;

        varying highp vec2 vTextureCoord;

        void main()
        {
          gl_Position = vec4(aPosition.x, aPosition.y, 0.0, 1.0);
          vTextureCoord = aTextureCoord;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        #version 100
        precision mediump float;

        uniform vec2 resolution;
        uniform vec2 offset;
        uniform float l;

        uniform sampler2D uSampler;

        varying highp vec2 vTextureCoord;

        float getBounds(float a) {
            float stroke = 1.;
            if (a < stroke || a > l - stroke) {
                return 1.;
            }
            return 0.;
        }

        void main()
        {   
            //float dx = 30.;

            vec2 st = (gl_FragCoord.xy) / resolution.xy;

            float origX = mod(gl_FragCoord.x + offset.x, l);
            float origY = mod(gl_FragCoord.y - offset.y, l);

            float x = mod(gl_FragCoord.x + offset.x, l) / l;
            float y = mod(gl_FragCoord.y - offset.y, l) / l;

            float bx = getBounds(origX);
            float by = getBounds(origY);

            if (bx == 1. || by == 1.) {
                gl_FragColor.rgb = vec3(0.);
                gl_FragColor.a = 1.0;
            } else {
                float tScale = 0.8;

                vec2 td = vec2(1. / tScale / 2. - 0.5);
                vec2 tCoords = vec2(x, y) / vec2(tScale) - td;

                tCoords.x = (tCoords.x + 1.) * 0.1;
                
                gl_FragColor = texture2D(uSampler, tCoords);
            }

            //gl_FragColor = vec4(st.x + offset.x / resolution.x, 0., 0., 1.);
        }
    </script>
</body>
</html>