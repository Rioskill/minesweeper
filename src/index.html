<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MineSweeper</title>

    <link rel="stylesheet" href="src/index.css" />

    <script src="build/index.js" defer></script>
</head>

<body>
    <!-- <div class="main">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </div> -->

    <main id="main">
        
    </main>

    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 100
        precision mediump float;

        attribute vec2 aPosition;
        attribute vec2 aTextureCoord;
        
        uniform vec2 fullSize;
        uniform vec2 viewSize;

        uniform vec2 offset;
        uniform float l;
        uniform vec2 matrixSize;

        varying vec2 pos;

        varying vec2 globalCoords;

        varying highp vec2 vTextureCoord;

        void main()
        {
            pos = aPosition / fullSize * matrixSize;
            globalCoords = aPosition;

            vec2 local = aPosition - offset;

            vec2 shader = local / viewSize * 2. - 1.;

            gl_Position = vec4(shader, 0.0, 1.0);

            vTextureCoord = aTextureCoord;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        #version 100
        precision mediump float;

        uniform vec2 fullSize;
        uniform vec2 viewSize;

        uniform vec2 offset;
        uniform float l;
        uniform vec2 matrixSize;

        uniform float minesVisible;

        uniform sampler2D uSampler;

        varying vec2 pos;
        varying vec2 globalCoords;
        varying highp vec2 vTextureCoord;

        float width = 1. / 11.;

        vec2 getTexCoord(vec2 orig, float tileX) {
            if (orig.x >= 150. * width) {
                return vec2((tileX + 9.) * width, orig.y);
            }

            if (orig.x >= 100. * width) {
                if (orig.x >= 110. * width && minesVisible == 1.) {
                    return vec2((tileX + 10.) * width, orig.y);
                }

                return vec2(tileX * width, orig.y);
            }

            if (orig.x >= 50. * width) {
                return vec2((tileX + 9.) * width, orig.y);
            }

            return orig;
        }

        bool isGrey(float coordX) {
            return coordX >= 100. * width &&
                   coordX <  110. * width ||
                   coordX >= 110. * width &&
                   coordX <= 111. * width &&
                   minesVisible == 0.;
        }

        void main()
        {   
            vec2 st = (gl_FragCoord.xy) / fullSize;

            vec2 p = fract(pos) * fullSize / matrixSize;

            vec2 maxP = fullSize / matrixSize;

            float pXPart = p.x / maxP.x;

            float stroke = 2.;
            
            
            vec2 localPart = gl_FragCoord.xy / viewSize.xy;

            vec2 offsetPart = offset / fullSize;
            vec2 combPart = (offset + viewSize) / fullSize;

            if (gl_FragCoord.y < 10. && localPart.x > offsetPart.x && localPart.x < combPart.x ||
                gl_FragCoord.x > viewSize.x - 10. && localPart.y > offsetPart.y && localPart.y < combPart.y)
            {
               gl_FragColor = vec4(vec3(0., 1., 0.), 1.);
            } else {

                if (p.x < stroke ||
                    p.x > maxP.x - stroke || 
                    p.y < stroke || 
                    p.y > maxP.y - stroke) {
                    gl_FragColor = vec4(vec3(0.), 1.);
                } else {
                    vec2 texCoord = getTexCoord(vTextureCoord, pXPart);

                    if (isGrey(vTextureCoord.x)) {
                        gl_FragColor = vec4(vec3(0.8), 1.);
                    } else {
                        //vec4 c = texture2D(uSampler, texCoord);

                        //vec4 color = vec4(1., 0., 0., 1.);

                        //if (c.a == 0.) {
                        //    gl_FragColor = vec4(1., 0., 0., 1.);
                        //} else {
                        //    gl_FragColor = c;
                        //}

                        gl_FragColor = texture2D(uSampler, texCoord);
                    }
                }
            }
        }
    </script>
</body>

</html>